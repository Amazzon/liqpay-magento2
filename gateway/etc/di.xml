<?xml version="1.0"?>
<!--
/**
 * Copyright Â© Pronko Consulting (https://www.pronkoconsulting.com)
 * See LICENSE for the license details.
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <type name="Pronko\LiqPayGateway\Gateway\Converter\ArrayToJson">
        <arguments>
            <argument name="serializer" xsi:type="object">Magento\Framework\Serialize\Serializer\Json</argument>
        </arguments>
    </type>

    <type name="Pronko\LiqPayGateway\Gateway\Request\PaymentActionProvider">
        <arguments>
            <argument name="config" xsi:type="object">Pronko\LiqPayGateway\Gateway\Config\Config</argument>
            <argument name="actionMapping" xsi:type="array">
                <item name="authorize_capture" xsi:type="string">pay</item>
            </argument>
        </arguments>
    </type>

    <!-- LiqPay Payment Adapter Virtual Type Configuration -->
    <virtualType name="PronkoLiqPayAdapter" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="string">pronko_liqpay</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form\Cc</argument>
            <argument name="infoBlockType" xsi:type="string">PronkoLiqPayConfigurableInfo</argument>
            <argument name="valueHandlerPool" xsi:type="object">PronkoLiqPayValueHandlerPool</argument>
            <argument name="commandPool" xsi:type="object">PronkoLiqPayCommandPool</argument>
            <argument name="validatorPool" xsi:type="object">PronkoLiqPayValidatorPool</argument>
        </arguments>
    </virtualType>

    <!-- LiqPay Payment Configurable Info -->
    <virtualType name="PronkoLiqPayConfigurableInfo" type="Magento\Payment\Block\ConfigurableInfo">
        <arguments>
            <argument name="data" xsi:type="array">
                <item name="methodCode" xsi:type="string">pronko_liqpay</item>
            </argument>
        </arguments>
    </virtualType>
    
    <!-- LiqPay validators infrastructure -->
    <virtualType name="PronkoLiqPayCountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Pronko\LiqPayGateway\Gateway\Config\Config</argument>
        </arguments>
    </virtualType>
    <virtualType name="PronkoLiqPayValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">PronkoLiqPayCountryValidator</item>
                <item name="currency" xsi:type="string">Pronko\LiqPayGateway\Gateway\Validator\CurrencyValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <!-- END LiqPay validators infrastructure -->

    <!-- LiqPay Value Handler Pool Configuration -->
    <virtualType name="PronkoLiqPayValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">PronkoLiqPayConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- LiqPay Value Handler Configuration -->
    <virtualType name="PronkoLiqPayConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Pronko\LiqPayGateway\Gateway\Config\Config</argument>
        </arguments>
    </virtualType>

    <!-- LiqPay Gateway Config -->
    <virtualType name="Pronko\LiqPayGateway\Gateway\Config\Config" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="string">pronko_liqpay</argument>
        </arguments>
    </virtualType>

    <type name="Pronko\LiqPayGateway\Gateway\Validator\CurrencyValidator">
        <arguments>
            <argument name="config" xsi:type="object">Pronko\LiqPayGateway\Gateway\Config\Config</argument>
        </arguments>
    </type>

    <!-- LiqPay Command Pool Configuration -->
    <virtualType name="PronkoLiqPayCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
<!--                <item name="capture" xsi:type="string">PronkoLiqPayCaptureCommand</item>-->
                <item name="capture" xsi:type="string">Magento\Payment\Gateway\Command\NullCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- LiqPay Request Capture Transaction Builder -->
    <virtualType name="PronkoLiqPayCaptureTransactionBuilder" type="Pronko\LiqPayGateway\Gateway\Request\RequestBuilder">
        <arguments>
            <argument name="builder" xsi:type="object">PronkoLiqPayCaptureBuilderComposite</argument>
        </arguments>
    </virtualType>

    <!-- LiqPay Request Capture Transaction Builder Composite -->
    <virtualType name="PronkoLiqPayCaptureBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="cardPayment" xsi:type="string">Pronko\LiqPayGateway\Gateway\Request\Builder\CardPaymentBuilder</item>
                <item name="signature" xsi:type="string">Pronko\LiqPayGateway\Gateway\Request\Builder\SignatureBuilder</item>
            </argument>
        </arguments>
    </virtualType>



    <!-- LiqPay Capture Command -->
<!--    <virtualType name="PronkoLiqPayCaptureCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">-->
<!--        <arguments>-->
<!--            <argument name="requestBuilder" xsi:type="object">PronkoLiqPayCaptureTransactionBuilder</argument>-->
<!--            <argument name="transferFactory" xsi:type="object">Pronko\LiqPayGateway\Gateway\Http\TransferFactory</argument>-->
<!--            <argument name="client" xsi:type="object">Pronko\LiqPayGateway\Gateway\Http\Client</argument>-->
<!--            <argument name="handler" xsi:type="object">PronkoLiqPayCaptureHandler</argument>-->
<!--            <argument name="validator" xsi:type="object">PronkoLiqPayResponseValidatorPool</argument>-->
<!--        </arguments>-->
<!--    </virtualType>-->

<!--    <virtualType name="PronkoLiqPayResponseValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorComposite">-->
<!--        <arguments>-->
<!--            <argument name="validators" xsi:type="array">-->
<!--                <item name="general" xsi:type="string">Pronko\LiqPayGateway\Gateway\Validator\GeneralResponseValidator</item>-->
<!--                <item name="hash" xsi:type="string">Pronko\LiqPayGateway\Gateway\Validator\TransactionHashResponseValidator</item>-->
<!--            </argument>-->
<!--        </arguments>-->
<!--    </virtualType>-->


    <!-- LiqPay HTTP Client -->
<!--    <type name="Pronko\LiqPayGateway\Gateway\Http\Client">-->
<!--        <arguments>-->
<!--            <argument name="logger" xsi:type="object">PronkoLiqPayLogger</argument>-->
<!--            <argument name="converter" xsi:type="object">Pronko\LiqPayGateway\Gateway\Converter\JsonToArray</argument>-->
<!--        </arguments>-->
<!--    </type>-->

    <!-- LiqPay Payment Method Logger -->
<!--    <virtualType name="PronkoLiqPayLogger" type="Magento\Payment\Model\Method\Logger">-->
<!--        <arguments>-->
<!--            <argument name="config" xsi:type="object">Pronko\LiqPayGateway\Gateway\Config\Config</argument>-->
<!--        </arguments>-->
<!--    </virtualType>-->

    <!-- LiqPay Payment Capture Handler-->
<!--    <virtualType name="PronkoLiqPayCaptureHandler" type="Magento\Payment\Gateway\Response\HandlerChain">-->
<!--        <arguments>-->
<!--            <argument name="handlers" xsi:type="array">-->
<!--                <item name="payment_details" xsi:type="string">Pronko\LiqPayGateway\Gateway\Response\PaymentDetailsHandler</item>-->
<!--                <item name="transaction_details" xsi:type="string">Pronko\LiqPayGateway\Gateway\Response\TransactionAdditionalInfoHandler</item>-->
<!--            </argument>-->
<!--        </arguments>-->
<!--    </virtualType>-->

    <!-- LiqPay Payment Gateway Config -->
<!--    <type name="Pronko\LiqPayGateway\Gateway\Config">-->
<!--        <arguments>-->
<!--            <argument name="valueHandlerPool" xsi:type="object">PronkoLiqPayValueHandlerPool</argument>-->
<!--        </arguments>-->
<!--    </type>-->
</config>
